<div class="interactive-map">
  <div class="map-header">
    <h1>Interactive Map</h1>
    <div class="map-controls">
      <div class="search-container">
        <input
          type="text"
          [(ngModel)]="searchQuery"
          (input)="onSearchQueryChange()"
          placeholder="Search locations..."
          class="search-input"
        />
        <button (click)="handleSearch()" class="search-btn">üîç</button>
      </div>
      
      <div class="map-style-selector">
        <select [(ngModel)]="mapStyle">
          <option *ngFor="let style of mapStyles" [value]="style.id">
            {{ style.preview }} {{ style.name }}
          </option>
        </select>
      </div>
    </div>
  </div>

  <div class="map-container">
    <div class="map-sidebar">
      <div class="sidebar-section">
        <h3>Map Layers</h3>
        <button (click)="showLayers = !showLayers" class="layers-toggle">
          {{ showLayers ? 'Hide' : 'Show' }} Layers
        </button>
        
        <div *ngIf="showLayers" class="layers-panel">
          <label *ngFor="let (active, layer) of activeLayers" class="layer-item">
            <input
              type="checkbox"
              [checked]="active"
              (change)="handleLayerToggle(layer)"
            />
            <span class="layer-name">
              {{ getLayerName(layer) }}
            </span>
          </label>
        </div>
      </div>

      <div class="sidebar-section">
        <h3>Quick Actions</h3>
        <div class="quick-actions">
          <button (click)="resetView()">Reset View</button>
          <button (click)="setDefaultZoom()">Default Zoom</button>
          <button (click)="clearSelection()">Clear Selection</button>
        </div>
      </div>

      <div class="sidebar-section">
        <h3>Map Info</h3>
        <div class="map-info">
          <div class="info-item">
            <span>Center:</span>
            <span>{{ mapCenter.lat.toFixed(4) }}, {{ mapCenter.lng.toFixed(4) }}</span>
          </div>
          <div class="info-item">
            <span>Zoom:</span>
            <span>{{ zoom }}</span>
          </div>
          <div class="info-item">
            <span>Markers:</span>
            <span>{{ filteredMarkers.length }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="map-main">
      <div 
        #mapRef
        class="map-display"
        (click)="handleMapClick($event)"
        (dblclick)="addCustomMarker($event)"
      >
        <!-- Map background simulation -->
        <div 
          class="map-background" 
          [style.background-image]="'url(\'https://via.placeholder.com/800x600/4caf50/fff?text=Map+View\')'"
          [style.transform]="'scale(' + (zoom / 10) + ')'"
        >
          <!-- Render markers -->
          <div
            *ngFor="let marker of filteredMarkers"
            class="map-marker"
            [style.left.px]="getMarkerPosition(marker).x"
            [style.top.px]="getMarkerPosition(marker).y"
            [style.background-color]="getMarkerColor(marker)"
            (click)="handleMarkerClick(marker); $event.stopPropagation()"
            [title]="marker.title"
          >
            <span class="marker-icon">{{ getMarkerIcon(marker) }}</span>
          </div>
        </div>

        <!-- Zoom controls -->
        <div class="zoom-controls">
          <button (click)="handleZoomIn()" class="zoom-btn">+</button>
          <button (click)="handleZoomOut()" class="zoom-btn">‚àí</button>
        </div>

        <!-- Info window -->
        <div *ngIf="showInfoWindow && selectedMarker" class="info-window">
          <div class="info-header">
            <h4>{{ selectedMarker.title }}</h4>
            <button (click)="showInfoWindow = false" class="close-btn">‚úï</button>
          </div>
          <div class="info-content">
            <div class="info-type">Type: {{ selectedMarker.type }}</div>
            <div class="info-description">{{ selectedMarker.description }}</div>
            <div class="info-coordinates">
              {{ selectedMarker.lat.toFixed(4) }}, {{ selectedMarker.lng.toFixed(4) }}
            </div>
          </div>
          <div class="info-actions">
            <button (click)="removeMarker(selectedMarker.id)">Remove</button>
            <button (click)="centerOnMarker(selectedMarker)">Center</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Search overlay -->
  <div *ngIf="showSearchOverlay" class="search-overlay">
    <div class="search-results">
      <div class="search-header">
        <h3>Search Results</h3>
        <button (click)="showSearchOverlay = false" class="close-btn">‚úï</button>
      </div>
      
      <div *ngIf="isSearching" class="search-loading">
        <div class="loading-spinner"></div>
        <span>Searching...</span>
      </div>
      
      <div *ngIf="!isSearching" class="search-results-list">
        <div *ngIf="searchResults.length > 0">
          <div
            *ngFor="let result of searchResults"
            class="search-result-item"
            (click)="handleSearchResultClick(result)"
          >
            <div class="result-title">{{ result.title }}</div>
            <div class="result-description">{{ result.description }}</div>
            <div class="result-type">{{ result.type }}</div>
          </div>
        </div>
        <div *ngIf="searchResults.length === 0" class="no-results">
          No results found for "{{ searchQuery }}"
        </div>
      </div>
    </div>
  </div>

  <div class="map-footer">
    <div class="map-instructions">
      <span>Click markers to view details ‚Ä¢ Double-click map to add marker ‚Ä¢ Use zoom controls to navigate</span>
    </div>
    <div class="map-legend">
      <div *ngFor="let (config, type) of markerTypes" class="legend-item">
        <div 
          class="legend-color" 
          [style.background-color]="config.color"
        >
          {{ config.icon }}
        </div>
        <span>{{ type }}</span>
      </div>
    </div>
  </div>
</div>
