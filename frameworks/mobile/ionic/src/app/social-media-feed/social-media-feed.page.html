<ion-header>
  <ion-toolbar>
    <ion-title>Social Feed</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="onNotificationsClicked()">
        <ion-icon name="notifications"></ion-icon>
        <ion-badge *ngIf="unreadNotifications > 0" color="danger">{{ unreadNotifications }}</ion-badge>
      </ion-button>
      <ion-button (click)="onTrendingClicked()">
        <ion-icon name="trending-up"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Filter Tabs -->
  <ion-toolbar class="filter-toolbar">
    <ion-segment [(ngModel)]="currentFilter" (ionChange)="onFilterChanged()">
      <ion-segment-button value="all">
        <ion-label>All</ion-label>
      </ion-segment-button>
      <ion-segment-button value="following">
        <ion-label>Following</ion-label>
      </ion-segment-button>
      <ion-segment-button value="trending">
        <ion-label>Trending</ion-label>
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>

  <!-- Create Post Button -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button (click)="onCreatePostClicked()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>

  <!-- Posts List -->
  <ion-list *ngIf="!isLoading" class="posts-list">
    <ion-item *ngFor="let post of posts" class="post-item">
      <div class="post-content">
        <!-- Post Header -->
        <div class="post-header">
          <ion-avatar class="user-avatar">
            <div class="avatar-text">{{ post.user.avatar }}</div>
          </ion-avatar>
          
          <div class="user-info">
            <div class="user-name">
              <span>{{ post.user.name }}</span>
              <ion-icon *ngIf="post.user.verified" name="checkmark-circle" color="primary"></ion-icon>
            </div>
            <div class="user-username">{{ post.user.username }}</div>
            <div class="post-timestamp">{{ post.timestamp }}</div>
          </div>
          
          <ion-button fill="clear" size="small" (click)="onPostMenuClicked(post.id)">
            <ion-icon name="ellipsis-horizontal"></ion-icon>
          </ion-button>
        </div>

        <!-- Post Content -->
        <div class="post-body">
          <p class="post-text">{{ post.content }}</p>
          
          <div class="post-image" *ngIf="post.hasImage">
            <div class="image-placeholder">{{ post.image }}</div>
          </div>
          
          <div class="post-location" *ngIf="post.hasLocation">
            <ion-icon name="location"></ion-icon>
            <span>{{ post.location }}</span>
          </div>
        </div>

        <!-- Post Actions -->
        <div class="post-actions">
          <ion-button 
            fill="clear" 
            size="small" 
            [class.active]="post.isLiked"
            (click)="onLikeClicked(post.id)">
            <ion-icon [name]="post.isLiked ? 'heart' : 'heart-outline'" [color]="post.isLiked ? 'danger' : 'medium'"></ion-icon>
            <span>{{ post.likes }}</span>
          </ion-button>
          
          <ion-button fill="clear" size="small" (click)="onCommentClicked(post.id)">
            <ion-icon name="chatbubble-outline"></ion-icon>
            <span>{{ post.comments }}</span>
          </ion-button>
          
          <ion-button fill="clear" size="small" (click)="onShareClicked(post.id)">
            <ion-icon name="arrow-redo-outline"></ion-icon>
            <span>{{ post.shares }}</span>
          </ion-button>
          
          <ion-button 
            fill="clear" 
            size="small" 
            [class.active]="post.isBookmarked"
            (click)="onBookmarkClicked(post.id)">
            <ion-icon [name]="post.isBookmarked ? 'bookmark' : 'bookmark-outline'" [color]="post.isBookmarked ? 'primary' : 'medium'"></ion-icon>
          </ion-button>
        </div>
      </div>
    </ion-item>
  </ion-list>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Loading posts...</p>
  </div>

  <!-- Empty State -->
  <div class="empty-container" *ngIf="!isLoading && posts.length === 0">
    <ion-icon name="newspaper" size="large"></ion-icon>
    <h3>No posts yet</h3>
    <p>Be the first to share something!</p>
    <ion-button (click)="onCreatePostClicked()">Create Post</ion-button>
  </div>
</ion-content>

<!-- Create Post Modal -->
<ion-modal [isOpen]="showCreatePost" (didDismiss)="onCreatePostDismissed()">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>Create Post</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="onCreatePostDismissed()">
            <ion-icon name="close"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    
    <ion-content>
      <ion-list>
        <ion-item>
          <ion-avatar slot="start">
            <div class="avatar-text">ðŸ‘¤</div>
          </ion-avatar>
          <ion-label>
            <h3>You</h3>
            <p>What's on your mind?</p>
          </ion-label>
        </ion-item>
        
        <ion-item>
          <ion-textarea
            [(ngModel)]="newPost.content"
            placeholder="What's on your mind?"
            rows="4">
          </ion-textarea>
        </ion-item>
        
        <ion-item>
          <ion-label>Add Location</ion-label>
          <ion-input [(ngModel)]="newPost.location" placeholder="Where are you?"></ion-input>
        </ion-item>
        
        <ion-item>
          <ion-label>Privacy</ion-label>
          <ion-select [(ngModel)]="newPost.privacy">
            <ion-select-option value="public">Public</ion-select-option>
            <ion-select-option value="friends">Friends Only</ion-select-option>
            <ion-select-option value="private">Private</ion-select-option>
          </ion-select>
        </ion-item>
      </ion-list>
    </ion-content>
    
    <ion-footer>
      <ion-toolbar>
        <ion-buttons slot="start">
          <ion-button (click)="onAddImage()">
            <ion-icon name="image"></ion-icon>
          </ion-button>
          <ion-button (click)="onAddLocation()">
            <ion-icon name="location"></ion-icon>
          </ion-button>
        </ion-buttons>
        <ion-buttons slot="end">
          <ion-button (click)="onCreatePostDismissed()">Cancel</ion-button>
          <ion-button (click)="onPublishPost()" [disabled]="!newPost.content?.trim()">Post</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-footer>
  </ng-template>
</ion-modal>

<!-- Post Details Modal -->
<ion-modal [isOpen]="showPostDetails" (didDismiss)="onPostDetailsDismissed()">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>Post Details</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="onPostDetailsDismissed()">
            <ion-icon name="close"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    
    <ion-content *ngIf="selectedPost">
      <ion-list>
        <ion-item>
          <ion-avatar slot="start">
            <div class="avatar-text">{{ selectedPost.user.avatar }}</div>
          </ion-avatar>
          <ion-label>
            <h2>{{ selectedPost.user.name }}</h2>
            <p>{{ selectedPost.user.username }} â€¢ {{ selectedPost.timestamp }}</p>
          </ion-label>
        </ion-item>
        
        <ion-item>
          <ion-label>
            <p>{{ selectedPost.content }}</p>
          </ion-label>
        </ion-item>
        
        <ion-item *ngIf="selectedPost.hasLocation">
          <ion-icon name="location" slot="start"></ion-icon>
          <ion-label>{{ selectedPost.location }}</ion-label>
        </ion-item>
        
        <ion-item>
          <ion-label>
            <h3>Engagement</h3>
            <p>{{ selectedPost.likes }} likes â€¢ {{ selectedPost.comments }} comments â€¢ {{ selectedPost.shares }} shares</p>
          </ion-label>
        </ion-item>
      </ion-list>
    </ion-content>
    
    <ion-footer>
      <ion-toolbar>
        <ion-button expand="block" (click)="onPostDetailsDismissed()">Close</ion-button>
      </ion-toolbar>
    </ion-footer>
  </ng-template>
</ion-modal>
