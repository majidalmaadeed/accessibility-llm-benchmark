<ion-header>
  <ion-toolbar>
    <ion-title>Registration Wizard</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Step Indicator -->
  <ion-card>
    <ion-card-content>
      <ion-grid>
        <ion-row class="step-indicator">
          <ion-col 
            *ngFor="let step of steps; let i = index" 
            size="2"
            class="step-container">
            <div 
              class="step-circle"
              [class.active]="currentStep >= step.id"
              [class.current]="currentStep === step.id">
              <ion-icon [name]="step.icon"></ion-icon>
            </div>
            <div 
              class="step-title"
              [class.active]="currentStep >= step.id">
              {{ step.title }}
            </div>
            <div 
              *ngIf="i < steps.length - 1"
              class="step-connector"
              [class.active]="currentStep > step.id">
            </div>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card-content>
  </ion-card>

  <!-- Step Content -->
  <ion-card>
    <ion-card-content>
      <!-- Personal Information Step -->
      <div *ngIf="currentStep === 1">
        <h2>Personal Information</h2>
        <p>Please provide your basic personal details.</p>
        
        <ion-item>
          <ion-label position="stacked">First Name *</ion-label>
          <ion-input 
            [(ngModel)]="formData.firstName"
            (ionInput)="clearError('firstName')"
            placeholder="Enter your first name"
            [class.error]="errors.firstName">
          </ion-input>
        </ion-item>
        <ion-note *ngIf="errors.firstName" color="danger">
          {{ errors.firstName }}
        </ion-note>

        <ion-item>
          <ion-label position="stacked">Last Name *</ion-label>
          <ion-input 
            [(ngModel)]="formData.lastName"
            (ionInput)="clearError('lastName')"
            placeholder="Enter your last name"
            [class.error]="errors.lastName">
          </ion-input>
        </ion-item>
        <ion-note *ngIf="errors.lastName" color="danger">
          {{ errors.lastName }}
        </ion-note>

        <ion-item>
          <ion-label position="stacked">Email Address *</ion-label>
          <ion-input 
            type="email"
            [(ngModel)]="formData.email"
            (ionInput)="clearError('email')"
            placeholder="Enter your email"
            [class.error]="errors.email">
          </ion-input>
        </ion-item>
        <ion-note *ngIf="errors.email" color="danger">
          {{ errors.email }}
        </ion-note>

        <ion-item>
          <ion-label position="stacked">Phone Number *</ion-label>
          <ion-input 
            type="tel"
            [(ngModel)]="formData.phone"
            (ionInput)="clearError('phone')"
            placeholder="Enter your phone number"
            [class.error]="errors.phone">
          </ion-input>
        </ion-item>
        <ion-note *ngIf="errors.phone" color="danger">
          {{ errors.phone }}
        </ion-note>

        <ion-item>
          <ion-label position="stacked">Date of Birth</ion-label>
          <ion-input 
            [(ngModel)]="formData.dateOfBirth"
            placeholder="MM/DD/YYYY">
          </ion-input>
        </ion-item>
      </div>

      <!-- Address Information Step -->
      <div *ngIf="currentStep === 2">
        <h2>Address Information</h2>
        <p>Please provide your current address details.</p>
        
        <ion-item>
          <ion-label position="stacked">Street Address *</ion-label>
          <ion-input 
            [(ngModel)]="formData.street"
            (ionInput)="clearError('street')"
            placeholder="Enter your street address"
            [class.error]="errors.street">
          </ion-input>
        </ion-item>
        <ion-note *ngIf="errors.street" color="danger">
          {{ errors.street }}
        </ion-note>

        <ion-grid>
          <ion-row>
            <ion-col size="6">
              <ion-item>
                <ion-label position="stacked">City *</ion-label>
                <ion-input 
                  [(ngModel)]="formData.city"
                  (ionInput)="clearError('city')"
                  placeholder="City"
                  [class.error]="errors.city">
                </ion-input>
              </ion-item>
              <ion-note *ngIf="errors.city" color="danger">
                {{ errors.city }}
              </ion-note>
            </ion-col>
            <ion-col size="6">
              <ion-item>
                <ion-label position="stacked">State *</ion-label>
                <ion-input 
                  [(ngModel)]="formData.state"
                  (ionInput)="clearError('state')"
                  placeholder="State"
                  [class.error]="errors.state">
                </ion-input>
              </ion-item>
              <ion-note *ngIf="errors.state" color="danger">
                {{ errors.state }}
              </ion-note>
            </ion-col>
          </ion-row>
        </ion-grid>

        <ion-grid>
          <ion-row>
            <ion-col size="6">
              <ion-item>
                <ion-label position="stacked">ZIP Code *</ion-label>
                <ion-input 
                  type="number"
                  [(ngModel)]="formData.zipCode"
                  (ionInput)="clearError('zipCode')"
                  placeholder="ZIP Code"
                  [class.error]="errors.zipCode">
                </ion-input>
              </ion-item>
              <ion-note *ngIf="errors.zipCode" color="danger">
                {{ errors.zipCode }}
              </ion-note>
            </ion-col>
            <ion-col size="6">
              <ion-item>
                <ion-label position="stacked">Country</ion-label>
                <ion-input 
                  [(ngModel)]="formData.country"
                  placeholder="Country">
                </ion-input>
              </ion-item>
            </ion-col>
          </ion-row>
        </ion-grid>
      </div>

      <!-- Preferences Step -->
      <div *ngIf="currentStep === 3">
        <h2>Preferences</h2>
        <p>Customize your experience with these optional settings.</p>
        
        <ion-item>
          <ion-label>
            <h3>Newsletter Subscription</h3>
            <p>Receive updates and news via email</p>
          </ion-label>
          <ion-toggle 
            [(ngModel)]="formData.newsletter"
            slot="end">
          </ion-toggle>
        </ion-item>

        <ion-item>
          <ion-label>
            <h3>Push Notifications</h3>
            <p>Get notified about important updates</p>
          </ion-label>
          <ion-toggle 
            [(ngModel)]="formData.notifications"
            slot="end">
          </ion-toggle>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Theme Preference</ion-label>
          <ion-select 
            [(ngModel)]="formData.theme"
            placeholder="Select Theme">
            <ion-select-option value="light">Light</ion-select-option>
            <ion-select-option value="dark">Dark</ion-select-option>
            <ion-select-option value="auto">Auto</ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Language</ion-label>
          <ion-select 
            [(ngModel)]="formData.language"
            placeholder="Select Language">
            <ion-select-option value="en">English</ion-select-option>
            <ion-select-option value="es">Spanish</ion-select-option>
            <ion-select-option value="fr">French</ion-select-option>
          </ion-select>
        </ion-item>
      </div>

      <!-- Payment Information Step -->
      <div *ngIf="currentStep === 4">
        <h2>Payment Information</h2>
        <p>Enter your payment details securely.</p>
        
        <ion-item>
          <ion-label position="stacked">Cardholder Name *</ion-label>
          <ion-input 
            [(ngModel)]="formData.cardholderName"
            (ionInput)="clearError('cardholderName')"
            placeholder="Name on card"
            [class.error]="errors.cardholderName">
          </ion-input>
        </ion-item>
        <ion-note *ngIf="errors.cardholderName" color="danger">
          {{ errors.cardholderName }}
        </ion-note>

        <ion-item>
          <ion-label position="stacked">Card Number *</ion-label>
          <ion-input 
            type="number"
            [(ngModel)]="formData.cardNumber"
            (ionInput)="clearError('cardNumber')"
            placeholder="1234 5678 9012 3456"
            [class.error]="errors.cardNumber">
          </ion-input>
        </ion-item>
        <ion-note *ngIf="errors.cardNumber" color="danger">
          {{ errors.cardNumber }}
        </ion-note>

        <ion-grid>
          <ion-row>
            <ion-col size="6">
              <ion-item>
                <ion-label position="stacked">Expiry Date *</ion-label>
                <ion-input 
                  [(ngModel)]="formData.expiryDate"
                  (ionInput)="clearError('expiryDate')"
                  placeholder="MM/YY"
                  [class.error]="errors.expiryDate">
                </ion-input>
              </ion-item>
              <ion-note *ngIf="errors.expiryDate" color="danger">
                {{ errors.expiryDate }}
              </ion-note>
            </ion-col>
            <ion-col size="6">
              <ion-item>
                <ion-label position="stacked">CVV *</ion-label>
                <ion-input 
                  type="password"
                  [(ngModel)]="formData.cvv"
                  (ionInput)="clearError('cvv')"
                  placeholder="123"
                  [class.error]="errors.cvv">
                </ion-input>
              </ion-item>
              <ion-note *ngIf="errors.cvv" color="danger">
                {{ errors.cvv }}
              </ion-note>
            </ion-col>
          </ion-row>
        </ion-grid>
      </div>

      <!-- Review Step -->
      <div *ngIf="currentStep === 5">
        <h2>Review & Confirm</h2>
        <p>Please review your information and accept the terms.</p>
        
        <ion-card>
          <ion-card-header>
            <ion-card-title>Personal Information</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-item>
              <ion-label>Name:</ion-label>
              <ion-note slot="end">{{ formData.firstName }} {{ formData.lastName }}</ion-note>
            </ion-item>
            <ion-item>
              <ion-label>Email:</ion-label>
              <ion-note slot="end">{{ formData.email }}</ion-note>
            </ion-item>
            <ion-item>
              <ion-label>Phone:</ion-label>
              <ion-note slot="end">{{ formData.phone }}</ion-note>
            </ion-item>
          </ion-card-content>
        </ion-card>

        <ion-card>
          <ion-card-header>
            <ion-card-title>Address</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-item>
              <ion-label>Address:</ion-label>
              <ion-note slot="end">{{ formData.street }}</ion-note>
            </ion-item>
            <ion-item>
              <ion-label>City, State ZIP:</ion-label>
              <ion-note slot="end">{{ formData.city }}, {{ formData.state }} {{ formData.zipCode }}</ion-note>
            </ion-item>
          </ion-card-content>
        </ion-card>

        <ion-card>
          <ion-card-header>
            <ion-card-title>Preferences</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-item>
              <ion-label>Newsletter:</ion-label>
              <ion-note slot="end">{{ formData.newsletter ? 'Yes' : 'No' }}</ion-note>
            </ion-item>
            <ion-item>
              <ion-label>Notifications:</ion-label>
              <ion-note slot="end">{{ formData.notifications ? 'Enabled' : 'Disabled' }}</ion-note>
            </ion-item>
            <ion-item>
              <ion-label>Theme:</ion-label>
              <ion-note slot="end">{{ formData.theme | titlecase }}</ion-note>
            </ion-item>
          </ion-card-content>
        </ion-card>

        <ion-item>
          <ion-checkbox 
            [(ngModel)]="formData.termsAccepted"
            (ionChange)="clearError('termsAccepted')"
            [class.error]="errors.termsAccepted">
          </ion-checkbox>
          <ion-label class="ion-margin-start">
            I accept the Terms and Conditions
          </ion-label>
        </ion-item>
        <ion-note *ngIf="errors.termsAccepted" color="danger">
          {{ errors.termsAccepted }}
        </ion-note>

        <ion-item>
          <ion-checkbox 
            [(ngModel)]="formData.privacyAccepted"
            (ionChange)="clearError('privacyAccepted')"
            [class.error]="errors.privacyAccepted">
          </ion-checkbox>
          <ion-label class="ion-margin-start">
            I accept the Privacy Policy
          </ion-label>
        </ion-item>
        <ion-note *ngIf="errors.privacyAccepted" color="danger">
          {{ errors.privacyAccepted }}
        </ion-note>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Loading Overlay -->
  <div *ngIf="isSubmitting" class="loading-overlay">
    <ion-spinner></ion-spinner>
    <p>Submitting...</p>
  </div>
</ion-content>

<!-- Navigation Footer -->
<ion-footer>
  <ion-toolbar>
    <ion-grid>
      <ion-row>
        <ion-col size="4">
          <ion-button 
            expand="block"
            fill="outline"
            (click)="previousStep()"
            [disabled]="currentStep === 1">
            <ion-icon name="chevron-back" slot="start"></ion-icon>
            Previous
          </ion-button>
        </ion-col>
        <ion-col size="4">
          <ion-label class="step-info">
            Step {{ currentStep }} of {{ totalSteps }}
          </ion-label>
        </ion-col>
        <ion-col size="4">
          <ion-button 
            expand="block"
            (click)="nextStep()"
            [disabled]="isSubmitting">
            <span *ngIf="currentStep < totalSteps">
              Next
              <ion-icon name="chevron-forward" slot="end"></ion-icon>
            </span>
            <span *ngIf="currentStep === totalSteps">
              <ion-spinner *ngIf="isSubmitting" name="crescent"></ion-spinner>
              {{ isSubmitting ? 'Submitting...' : 'Submit' }}
            </span>
          </ion-button>
        </ion-col>
      </ion-row>
    </ion-grid>
  </ion-toolbar>
</ion-footer>
