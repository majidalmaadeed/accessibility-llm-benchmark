<ion-header>
  <ion-toolbar>
    <ion-title>Employee Data Table</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="toggleFilters()">
        <ion-icon name="filter"></ion-icon>
      </ion-button>
      <ion-button (click)="exportData('CSV')">
        <ion-icon name="download"></ion-icon>
      </ion-button>
      <ion-button (click)="refreshData()">
        <ion-icon name="refresh"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Search Bar -->
  <ion-card>
    <ion-card-content>
      <ion-grid>
        <ion-row>
          <ion-col size="10">
            <ion-searchbar
              [(ngModel)]="searchQuery"
              (ionInput)="onSearchChange()"
              placeholder="Search employees..."
              show-clear-button="true">
            </ion-searchbar>
          </ion-col>
          <ion-col size="2">
            <ion-button 
              expand="block" 
              (click)="toggleFilters()"
              color="primary">
              Filter
            </ion-button>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card-content>
  </ion-card>

  <!-- Filters -->
  <ion-card *ngIf="showFilters">
    <ion-card-header>
      <ion-grid>
        <ion-row>
          <ion-col size="10">
            <ion-card-title>Filters</ion-card-title>
          </ion-col>
          <ion-col size="2">
            <ion-button 
              fill="clear" 
              (click)="clearFilters()"
              color="primary">
              Clear All
            </ion-button>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card-header>
    <ion-card-content>
      <ion-grid>
        <ion-row>
          <ion-col size="6">
            <ion-item>
              <ion-label position="stacked">Department</ion-label>
              <ion-select 
                [(ngModel)]="departmentFilter"
                (ionChange)="onFilterChange()"
                placeholder="Select Department">
                <ion-select-option value="All">All</ion-select-option>
                <ion-select-option value="Engineering">Engineering</ion-select-option>
                <ion-select-option value="Marketing">Marketing</ion-select-option>
                <ion-select-option value="Sales">Sales</ion-select-option>
                <ion-select-option value="HR">HR</ion-select-option>
                <ion-select-option value="Finance">Finance</ion-select-option>
              </ion-select>
            </ion-item>
          </ion-col>
          <ion-col size="6">
            <ion-item>
              <ion-label position="stacked">Status</ion-label>
              <ion-select 
                [(ngModel)]="statusFilter"
                (ionChange)="onFilterChange()"
                placeholder="Select Status">
                <ion-select-option value="All">All</ion-select-option>
                <ion-select-option value="Active">Active</ion-select-option>
                <ion-select-option value="Inactive">Inactive</ion-select-option>
                <ion-select-option value="Pending">Pending</ion-select-option>
                <ion-select-option value="Terminated">Terminated</ion-select-option>
              </ion-select>
            </ion-item>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card-content>
  </ion-card>

  <!-- Bulk Actions -->
  <ion-card *ngIf="selectedRows.length > 0" color="primary">
    <ion-card-content>
      <ion-grid>
        <ion-row>
          <ion-col size="8">
            <ion-label>
              {{ selectedRows.length }} item{{ selectedRows.length !== 1 ? 's' : '' }} selected
            </ion-label>
          </ion-col>
          <ion-col size="4">
            <ion-buttons>
              <ion-button (click)="bulkAction('Edit')" size="small">
                Edit
              </ion-button>
              <ion-button (click)="bulkAction('Delete')" size="small" color="danger">
                Delete
              </ion-button>
              <ion-button (click)="bulkAction('Export')" size="small">
                Export
              </ion-button>
            </ion-buttons>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card-content>
  </ion-card>

  <!-- Data Table -->
  <ion-card>
    <ion-card-content>
      <!-- Table Header -->
      <ion-grid>
        <ion-row class="table-header">
          <ion-col size="1">
            <ion-checkbox 
              [(ngModel)]="selectAllChecked"
              (ionChange)="onSelectAllChange()">
            </ion-checkbox>
          </ion-col>
          <ion-col size="2">
            <ion-button 
              fill="clear" 
              (click)="sort('name')"
              color="primary">
              Name
              <ion-icon 
                *ngIf="sortColumn === 'name'" 
                [name]="sortAscending ? 'arrow-up' : 'arrow-down'">
              </ion-icon>
            </ion-button>
          </ion-col>
          <ion-col size="2">
            <ion-button 
              fill="clear" 
              (click)="sort('email')"
              color="primary">
              Email
              <ion-icon 
                *ngIf="sortColumn === 'email'" 
                [name]="sortAscending ? 'arrow-up' : 'arrow-down'">
              </ion-icon>
            </ion-button>
          </ion-col>
          <ion-col size="2">
            <ion-button 
              fill="clear" 
              (click)="sort('department')"
              color="primary">
              Department
              <ion-icon 
                *ngIf="sortColumn === 'department'" 
                [name]="sortAscending ? 'arrow-up' : 'arrow-down'">
              </ion-icon>
            </ion-button>
          </ion-col>
          <ion-col size="2">
            <ion-button 
              fill="clear" 
              (click)="sort('salary')"
              color="primary">
              Salary
              <ion-icon 
                *ngIf="sortColumn === 'salary'" 
                [name]="sortAscending ? 'arrow-up' : 'arrow-down'">
              </ion-icon>
            </ion-button>
          </ion-col>
          <ion-col size="2">
            <ion-button 
              fill="clear" 
              (click)="sort('status')"
              color="primary">
              Status
              <ion-icon 
                *ngIf="sortColumn === 'status'" 
                [name]="sortAscending ? 'arrow-up' : 'arrow-down'">
              </ion-icon>
            </ion-button>
          </ion-col>
          <ion-col size="1">
            <ion-label>Actions</ion-label>
          </ion-col>
        </ion-row>

        <!-- Table Rows -->
        <ion-row 
          *ngFor="let employee of currentPageData; let i = index"
          class="table-row"
          [class.selected]="selectedRows.includes(employee.id)">
          <ion-col size="1">
            <ion-checkbox 
              [(ngModel)]="employee.selected"
              (ionChange)="onRowSelectionChange(employee.id, $event.detail.checked)">
            </ion-checkbox>
          </ion-col>
          <ion-col size="2">
            <ion-label>{{ employee.name }}</ion-label>
          </ion-col>
          <ion-col size="2">
            <ion-label color="primary">{{ employee.email }}</ion-label>
          </ion-col>
          <ion-col size="2">
            <ion-label>{{ employee.department }}</ion-label>
          </ion-col>
          <ion-col size="2">
            <ion-label>{{ employee.salary | currency:'USD':'symbol':'1.0-0' }}</ion-label>
          </ion-col>
          <ion-col size="2">
            <ion-chip 
              [color]="employee.status === 'Active' ? 'success' : 'danger'"
              size="small">
              {{ employee.status }}
            </ion-chip>
          </ion-col>
          <ion-col size="1">
            <ion-buttons>
              <ion-button 
                (click)="rowAction('view', employee.id)"
                size="small"
                fill="clear">
                <ion-icon name="eye"></ion-icon>
              </ion-button>
              <ion-button 
                (click)="rowAction('edit', employee.id)"
                size="small"
                fill="clear">
                <ion-icon name="create"></ion-icon>
              </ion-button>
              <ion-button 
                (click)="rowAction('delete', employee.id)"
                size="small"
                fill="clear"
                color="danger">
                <ion-icon name="trash"></ion-icon>
              </ion-button>
            </ion-buttons>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card-content>
  </ion-card>

  <!-- Empty State -->
  <ion-card *ngIf="filteredData.length === 0 && !isLoading">
    <ion-card-content class="empty-state">
      <ion-icon name="table" size="large" color="medium"></ion-icon>
      <h2>No data found</h2>
      <p>Try adjusting your search or filter criteria</p>
      <ion-button (click)="clearFilters()" color="primary">
        Clear all filters
      </ion-button>
    </ion-card-content>
  </ion-card>

  <!-- Loading State -->
  <ion-card *ngIf="isLoading">
    <ion-card-content class="loading-state">
      <ion-spinner></ion-spinner>
      <p>Loading data...</p>
    </ion-card-content>
  </ion-card>

  <!-- Pagination -->
  <ion-card>
    <ion-card-content>
      <ion-grid>
        <ion-row>
          <ion-col size="6">
            <ion-label>
              Showing {{ startIndex + 1 }}-{{ endIndex }} of {{ filteredData.length }} results
            </ion-label>
          </ion-col>
          <ion-col size="6">
            <ion-buttons>
              <ion-button 
                (click)="previousPage()"
                [disabled]="currentPage === 1"
                size="small">
                Previous
              </ion-button>
              <ion-label>Page {{ currentPage }} of {{ totalPages }}</ion-label>
              <ion-button 
                (click)="nextPage()"
                [disabled]="currentPage === totalPages"
                size="small">
                Next
              </ion-button>
              <ion-select 
                [(ngModel)]="itemsPerPage"
                (ionChange)="onItemsPerPageChange()"
                placeholder="Items per page"
                size="small">
                <ion-select-option value="5">5 per page</ion-select-option>
                <ion-select-option value="10">10 per page</ion-select-option>
                <ion-select-option value="25">25 per page</ion-select-option>
                <ion-select-option value="50">50 per page</ion-select-option>
                <ion-select-option value="100">100 per page</ion-select-option>
              </ion-select>
            </ion-buttons>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card-content>
  </ion-card>
</ion-content>
